#!/bin/bash

if [ -z ${EA_SHOULD_COPY+x} ]; then
    EA_SHOULD_COPY=false
fi

if [ -z ${EA_SHOULD_PASTE+x} ]; then
    EA_SHOULD_PASTE=true
fi

if [ "$EA_SHOULD_COPY" = true ]; then
    xdotool key --clearmodifiers ctrl+c
fi

EA_WINDOW=$( xdotool getactivewindow )

EA_APP_NAME=$( xprop -id $EA_WINDOW WM_CLASS | grep -oE '[^ ]+$' )
EA_WINDOW_TITLE=$( xprop -id $EA_WINDOW _NET_WM_NAME | cut -d" " -f3- )

export EA_APP_NAME
export EA_WINDOW_TITLE

$HOME/.emacs_anywhere/bin/emacstask
. /tmp/eaenv

if [ "$EA_ABORT" = true ]; then
    exit 0;
fi

xdotool windowactivate --sync $EA_WINDOW

if [ "$EA_SHOULD_PASTE" = true ]; then
    xdotool key --clearmodifiers ctrl+v
fi
